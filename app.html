<!DOCTYPE html>
<html>
<head>
	<script src='dist/fhir-client-v2.js'></script>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <link rel="stylesheet" href="app.css">
</head>

<body>
<h1>Patient Demographics</h1>
<div id="box">
<table>
  <tr>
    <th>First Name</th>
    <th>Last Name</th>
    <th>Mobile</th>
  </tr>
  <tr>
      <td id="firstName"></td>
      <td id="lastName"></td>
      <td id="mobile"></td>
  </tr>
  </table>
  <table>
    <tr>
      <th>Language</th>
      <th>Gender</th>
      <th>DOB</th>
    </tr>
    <tr>
      <td id="language"></td>
      <td id="gender"></td>
      <td id="DOB"></td>
    </tr>
  </table>
  <table>
    <tr>
      <th>Address</th>
    </tr>
    <tr>
      <td id="address"></td>
    </tr>
  </table>
</div>
	<script>
		var myApp = {}
    FHIR.oauth2.ready()
    .then(function(client){ 
      myApp.smart = client
      doRequests()
    });

    async function doRequests(){
      var obs = await fetch(myApp.smart.state.serverUrl+"/Patient/"+myApp.smart.patient.id,{
        headers:{  
          "Accept":"application/json+fhir",
          "Authorization":"Bearer "+myApp.smart.state.tokenResponse.access_token
        }
        }).then(function(data){
          return data
      });
      var response = await obs.json()
      var firstName = response.name?(response.name[0].given||'Nil'):'Nil';
      var lastName = response.name?(response.name[0].family||'Nil'):'Nil';
      var mobile = response.telecom? (response.telecom[0].value || 'Nil'):'Nil';
      var language = response.communication?(response.communication[0].language.text||'Nil') : 'Nil';
      var gender = response.gender || 'Nil';
      var DOB = response.birthDate || 'Nil';
      var address = response.contact?(response.contact[0].address?      JSON.stringify(response.contact[0].address):'Nil'):'Nil';
            
      $("#lastName").html(lastName)
      $("#firstName").html(firstName)
      $("#mobile").html(mobile)
      $("#language").html(language)
      $("#gender").html(gender)
      $("#DOB").html(DOB)
      $("#address").html(address)
    }
	</script>
</body>
</html>
